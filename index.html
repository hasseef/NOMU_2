<style>
/* ======= أكمال الحسابات + التبويبات + مؤشرات KPI (تصميم احترافي خفيف) ======= */
:root{
  --ink:#0f172a; --muted:#64748b; --border:#e6e9ef;
  --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444; --info:#0ea5e9;
}
/* تبويبات الحساب */
.acc-tabs{ display:flex; gap:8px; flex-wrap:wrap; margin:12px 0 8px }
.acc-tab{
  padding:10px 12px; border:1px solid var(--border); border-radius:10px;
  background:#fff; cursor:pointer; font-weight:600; color:var(--ink); text-decoration:none;
}
.acc-tab[aria-selected="true"]{ border-color:var(--info); outline:2px solid rgba(14,165,233,.15) }

/* شبكة KPI */
.kpi-grid{ display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:12px }
.kpi-card{
  border:1px solid var(--border); border-radius:12px; background:#fff; padding:12px; display:flex; gap:10px; align-items:flex-start
}
.kpi-icon{ font-size:22px; line-height:1; padding:8px; border-radius:10px; background:#f1f5f9 }
.kpi-body{ flex:1; min-width:0 }
.kpi-title{ font-weight:700; color:var(--ink); white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.kpi-meta{ display:flex; gap:10px; align-items:center; margin-top:4px; color:var(--muted); font-size:12px }
.kpi-value{ font-weight:800; font-size:18px; color:var(--ink) }
.badge{ padding:3px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border); background:#fff }
.badge.ok{ color:#065f46; border-color:#bbf7d0; background:#ecfdf5 }
.badge.warn{ color:#92400e; border-color:#fde68a; background:#fffbeb }
.badge.bad{ color:#991b1b; border-color:#fecaca; background:#fef2f2 }
.badge.info{ color:#075985; border-color:#bae6fd; background:#eff6ff }

/* جداول المؤشرات/التقارير */
.table{ width:100%; border-collapse:separate; border-spacing:0 8px }
.table th{ text-align:start; font-size:13px; color:var(--muted); padding:0 10px }
.table td{ background:#fff; border:1px solid var(--border); padding:10px; }
.table tr td:first-child{ border-radius:12px 0 0 12px }
.table tr td:last-child{ border-radius:0 12px 12px 0 }

/* بطاقات عامة */
.card{ border:1px solid var(--border); border-radius:12px; background:#fff; padding:12px }

/* ترتيب الجوال */
@media (max-width:979px){
  .kpi-grid{ grid-template-columns:1fr 1fr }
  .acc-tabs{ position:sticky; top:60px; background:#fff; padding:8px 0; z-index:20 }
}
</style>

<script>
/* ======= أكمال الحسابات + تبويبات + KPI جاهزة ======= */
(function(){
  const view = document.getElementById('view') || document.body;

  // تعريف الحسابات والتبويبات
  const ACCOUNTS = {
    "health":    { name:"وزارة الصحة", icon:"🏥" },
    "clinic":    { name:"المراكز الصحية", icon:"🩺" },
    "education": { name:"وزارة التعليم", icon:"🎓" },
    "neighborhood": { name:"مراكز الأحياء", icon:"🏘️" },
    "nonprofit": { name:"الجمعيات", icon:"🤝" },
    "hr":        { name:"الموارد البشرية", icon:"👤" },
    "csr":       { name:"القطاع الخاص", icon:"🏢" },
    "family":    { name:"الأسرة", icon:"👨‍👩‍👧" },
    "admin":     { name:"اللجنة الوطنية", icon:"🛡️" },
  };
  const TABS = [
    {key:"summary",   label:"ملخص"},
    {key:"operations",label:"العمليات"},
    {key:"indicators",label:"المؤشرات"},
    {key:"reports",   label:"التقارير"},
    {key:"resources", label:"الموارد"},
    {key:"governance",label:"الحوكمة"},
  ];

  // عناوين مؤشرات احترافية افتراضية (تُستخدم إن لم توجد بيانات حقيقية)
  const KPI_TITLES = [
    {t:"نسبة تغطية الفحص المبكر",        icon:"🧪"},
    {t:"إتمام التطعيمات الأساسية",       icon:"💉"},
    {t:"زمن الانتظار المتوسط (دقيقة)",    icon:"⏱️"},
    {t:"التزام البروتوكولات السريرية",   icon:"📋"},
    {t:"جودة البيانات واكتمالها",        icon:"📊"},
    {t:"التغطية الجغرافية للخدمات",      icon:"🗺️"},
    {t:"معدل الإحالات المغلقة",          icon:"🔁"},
    {t:"رضا المستفيدين",                 icon:"⭐"},
    {t:"نسبة الحالات عالية الخطورة",     icon:"⚠️"},
    {t:"كفاءة الإنفاق",                  icon:"💰"},
    {t:"التكامل بين الجهات",             icon:"🧩"},
    {t:"الأثر المجتمعي",                 icon:"🌱"},
  ];

  // توليد بيانات عرضية محسّنة (يمكنك ربطها لاحقًا ببياناتك الفعلية)
  function makeDemoKPIs(){
    return KPI_TITLES.map((k, i)=>{
      // قيم تجريبية منطقية
      let v, unit = "";
      if (k.t.includes("زمن الانتظار")) { v = 5 + Math.floor(Math.random()*20); unit="د"; }
      else if (k.t.includes("حالات عالية")) { v = (3 + Math.random()*7).toFixed(1); unit="%"; }
      else if (k.t.includes("كفاءة الإنفاق")) { v = (80 + Math.random()*15).toFixed(0); unit="%"; }
      else if (k.t.includes("رضا") || k.t.includes("التزام") || k.t.includes("جودة") || k.t.includes("التكامل") || k.t.includes("الفحص") || k.t.includes("التطعيمات") || k.t.includes("التغطية") || k.t.includes("الإحالات") || k.t.includes("الأثر")) {
        v = (70 + Math.random()*25).toFixed(0); unit="%";
      } else { v = (50 + Math.random()*40).toFixed(0); unit="%"; }
      const num = typeof v === "number" ? v : parseFloat(v);
      let grade = "info";
      if (unit==="%"){
        if (num >= 85) grade="ok";
        else if (num >= 70) grade="warn";
        else grade="bad";
      } else if (k.t.includes("زمن الانتظار")){
        if (num <= 10) grade="ok";
        else if (num <= 20) grade="warn";
        else grade="bad";
      }
      return { title:k.t, icon:k.icon, value: v + (unit||""), trend: (Math.random()>.5?"+":"-") + (Math.random()*5|0) + "%", grade };
    });
  }

  // قالب صفحة الحساب
  function renderAccount(accKey, tabKey){
    const acc = ACCOUNTS[accKey];
    if (!acc){ view.innerHTML = notFound(); return; }
    const currentTab = TABS.find(t=>t.key===tabKey) ? tabKey : "summary";

    let html = `
      <div class="card" style="display:flex;justify-content:space-between;align-items:center;gap:10px">
        <div style="display:flex;align-items:center;gap:10px">
          <div class="kpi-icon" aria-hidden="true" style="font-size:24px">${acc.icon}</div>
          <div>
            <div style="font-weight:800">${acc.name}</div>
            <div style="color:var(--muted);font-size:13px">لوحة تحكم الحساب · تبويب: <b>${TABS.find(t=>t.key===currentTab).label}</b></div>
          </div>
        </div>
        <a class="btn ghost" href="#/reports">اختصار للتقارير</a>
      </div>
      <nav class="acc-tabs" role="tablist" aria-label="تبويبات الحساب">`+
        TABS.map(t=>`<a class="acc-tab" role="tab" aria-selected="${t.key===currentTab}" href="#/acc/${accKey}?tab=${t.key}">${t.label}</a>`).join("")+
      `</nav>
      <div id="accContent"></div>
    `;
    view.innerHTML = html;

    // محتوى التبويب
    const mount = document.getElementById('accContent');
    if (currentTab==="summary"){
      const kpis = makeDemoKPIs().slice(0,8); // ٨ بطاقات للملخص
      mount.innerHTML = `
        <div class="kpi-grid">
          ${kpis.map(k=>`
            <div class="kpi-card">
              <div class="kpi-icon">${k.icon}</div>
              <div class="kpi-body">
                <div class="kpi-title" title="${k.title}">${k.title}</div>
                <div class="kpi-meta">
                  <span class="kpi-value">${k.value}</span>
                  <span class="badge ${k.grade}">${gradeLabel(k.grade)}</span>
                  <span class="badge info">المدى: 30ي</span>
                  <span class="badge">${k.trend}</span>
                </div>
              </div>
            </div>`).join("")}
        </div>
        <div class="card" style="margin-top:12px">
          <b>ملاحظات ملخص سريع</b>
          <ul style="margin:6px 0 0 0;padding-inline-start:18px;color:var(--muted);font-size:14px">
            <li>الأرقام للعرض فقط — اربطها لاحقًا بمصدر بياناتك.</li>
            <li>الشارات تعكس التقييم (جيد/تحذير/حرِج) آليًا وفق القيمة.</li>
          </ul>
        </div>`;
    }
    else if (currentTab==="operations"){
      mount.innerHTML = `
        <div class="card"><b>أعمال جارية</b>
          <ul style="margin:8px 0 0 0;padding-inline-start:18px">
            <li>تفعيل حملة الفحص المبكر في المناطق ذات التغطية المنخفضة</li>
            <li>مراجعة مسار الإحالات بين الجهة والعيادات الطرفية</li>
            <li>إطلاق لوحة متابعة زمن الانتظار الأسبوعية</li>
          </ul>
        </div>`;
    }
    else if (currentTab==="indicators"){
      const kpis = makeDemoKPIs(); // ١٢ مؤشر
      mount.innerHTML = `
        <table class="table">
          <thead><tr>
            <th>المؤشر</th><th>القيمة</th><th>التقييم</th><th>الاتجاه</th><th>آخر تحديث</th>
          </tr></thead>
          <tbody>
            ${kpis.map(k=>`
              <tr>
                <td>${k.title}</td>
                <td><b>${k.value}</b></td>
                <td><span class="badge ${k.grade}">${gradeLabel(k.grade)}</span></td>
                <td><span class="badge">${k.trend}</span></td>
                <td><span class="badge info">اليوم</span></td>
              </tr>`).join("")}
          </tbody>
        </table>`;
    }
    else if (currentTab==="reports"){
      mount.innerHTML = `
        <div class="card"><b>تقارير متاحة</b>
          <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px">
            ${["تقرير الأداء الشهري","تقرير الجودة والامتثال","تقرير الإحالات والانتظار"].map(t=>`
              <a class="card" href="#" onclick="return false" style="text-decoration:none;color:var(--ink)">${t}<br><span style="color:var(--muted);font-size:12px">PDF · آخر إصدار</span></a>
            `).join("")}
          </div>
        </div>`;
    }
    else if (currentTab==="resources"){
      mount.innerHTML = `
        <div class="card"><b>الموارد</b>
          <ul style="margin:8px 0 0 0;padding-inline-start:18px">
            <li><a href="#/policies">الأدلة والسياسات</a></li>
            <li><a href="#/support">الدعم الفني</a></li>
            <li><a href="#/contact">اتصل بنا</a></li>
          </ul>
        </div>`;
    }
    else if (currentTab==="governance"){
      mount.innerHTML = `
        <div class="card"><b>الحوكمة والأدوار</b>
          <p style="color:var(--muted)">تعريف المسؤوليات والنطاقات والصلاحيات لكل جهة ضمن هذا الحساب.</p>
          <ul style="margin:8px 0 0 0;padding-inline-start:18px">
            <li>مالك الحساب</li>
            <li>مشرف المؤشرات</li>
            <li>منسق التقارير</li>
            <li>دعم فني</li>
          </ul>
        </div>`;
    }
  }

  // أدوات مساعدة
  function gradeLabel(g){
    if (g==="ok") return "جيد";
    if (g==="warn") return "تحذير";
    if (g==="bad") return "حرِج";
    return "معلومة";
  }
  function notFound(){
    return '<div class="card" style="padding:16px"><h2>لم يتم العثور على الصفحة</h2><p>تحقق من الرابط أو اختر صفحة من القائمة.</p></div>';
  }
  function parseRoute(){
    const h = location.hash || "";
    // أمثلة: #/acc/health?tab=summary
    const m = h.match(/^#\/acc\/([^?]+)(?:\?tab=([a-z]+))?/);
    if (m) return {type:"acc", key:m[1], tab:m[2] || "summary"};
    return null;
  }

  // مبدّل الراوتر
  function onRoute(){
    const r = parseRoute();
    if (r && r.type==="acc") renderAccount(r.key, r.tab);
  }

  window.addEventListener("hashchange", onRoute);
  window.addEventListener("load", onRoute);
})();
</script>
