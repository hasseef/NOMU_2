<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ููุตุฉ ููู โ ุงููุณุฎุฉ ุงูููุงุฆูุฉ ุงูุชูุงุนููุฉ</title>
<meta name="color-scheme" content="light only">
<style>
:root{--ink:#0f172a;--muted:#64748b;--border:#e6e9ef;--bg:#fff;--brand:#0ea5e9}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Naskh Arabic UI",sans-serif;color:var(--ink);background:#fff}
/* Topbar */
header .topbar{display:flex;align-items:center;gap:10px;padding:10px 12px;min-height:60px;border-bottom:1px solid var(--border);position:sticky;top:0;background:#fff;z-index:60}
.brand{display:flex;align-items:center;gap:10px;cursor:pointer;min-width:0}
.brand .logo{width:52px;height:52px;border-radius:14px;background:#fff;object-fit:contain}
.brand-title{font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:45vw}
.home-btn,.desktop-login-btn,.btn{display:inline-flex;align-items:center;gap:6px;background:var(--brand);color:#fff;border:0;border-radius:10px;padding:8px 12px;font-size:13px;text-decoration:none;cursor:pointer}
.btn.ghost{background:#fff;border:1px solid var(--border);color:var(--ink)}
.left-logos{margin-inline-start:auto;display:flex;align-items:center;gap:8px}
.left-logos img{height:28px;width:auto;object-fit:contain}
.bell{position:relative;width:40px;height:40px;border:1px solid var(--border);border-radius:12px;background:#fff}
.badge-dot{position:absolute;inset:auto auto 2px 2px;width:8px;height:8px;border-radius:99px;background:#ef4444}
/* Layout */
@media (min-width:980px){
  .layout{display:grid;grid-template-columns:280px 1fr;gap:16px;padding:16px}
  .mega-left{position:sticky;top:76px;align-self:start}
  .mega-left details{border:1px solid var(--border);border-radius:12px;margin:8px 0;background:#fff;overflow:hidden}
  .mega-left summary{list-style:none;cursor:pointer;padding:10px 12px;font-weight:700}
  .mega-left summary::-webkit-details-marker{display:none}
  .mega-left .group-body{padding:8px 10px;display:grid;gap:6px}
  .mega-left a{padding:8px 10px;border-radius:10px;color:#334155;text-decoration:none}
  .mega-left a:hover{background:#f1f5f9}
  nav.side{display:none!important}
}
#view{padding:16px}
.card{border:1px solid var(--border);border-radius:12px;background:#fff;padding:16px}
.section-title{display:flex;align-items:center;gap:8px;margin:0 0 8px 0}
/* Tabs */
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0 8px}
.tab{padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:#fff;cursor:pointer;font-weight:600;text-decoration:none;color:var(--ink)}
.tab[aria-selected="true"]{border-color:#0ea5e9;outline:2px solid rgba(14,165,233,.15)}
/* KPI */
.kpi-grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}
.kpi-card{border:1px solid var(--border);border-radius:12px;background:#fff;padding:12px;display:flex;gap:10px;align-items:flex-start;cursor:pointer}
.kpi-card:hover{box-shadow:0 8px 24px rgba(2,12,27,.08)}
.kpi-icon{font-size:22px;padding:8px;border-radius:10px;background:#f1f5f9}
.kpi-title{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.kpi-meta{display:flex;gap:10px;align-items:center;margin-top:4px;color:#64748b;font-size:12px}
.kpi-value{font-weight:800;font-size:18px}
.badge{padding:3px 8px;border-radius:999px;border:1px solid var(--border);background:#fff;font-size:12px}
.badge.ok{color:#065f46;border-color:#bbf7d0;background:#ecfdf5}
.badge.warn{color:#92400e;border-color:#fde68a;background:#fffbeb}
.badge.bad{color:#991b1b;border-color:#fecaca;background:#fef2f2}
.badge.info{color:#075985;border-color:#bae6fd;background:#eff6ff}
/* Tables */
.table{width:100%;border-collapse:separate;border-spacing:0 8px}
.table th{font-size:13px;color:#64748b;padding:0 10px;cursor:pointer;user-select:none}
.table td{background:#fff;border:1px solid var(--border);padding:10px}
.table tr td:first-child{border-radius:12px 0 0 12px}
.table tr td:last-child{border-radius:0 12px 12px 0}
/* Services */
.toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:8px 0 12px}
.input{border:1px solid var(--border);border-radius:10px;padding:10px 12px;font-size:14px;background:#fff}
.services-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
.service{border:1px solid var(--border);border-radius:12px;background:#fff;padding:12px}
.service h4{margin:0 0 6px 0}
.service p{margin:0;color:#64748b;font-size:13px}
/* Mobile */
.mobile-menu-btn{display:none}
@media (max-width:979px){
  .brand-title{max-width:52vw}
  .left-logos img{height:22px}
  .mobile-menu-btn{display:inline-flex;align-items:center;gap:6px;margin-inline-start:8px;background:#0ea5e9;color:#fff;border:none;border-radius:10px;padding:6px 10px;font-size:13px}
  .layout{display:block;padding:12px}
  .mega-left{display:none}
  .tabs,.toolbar{display:block}
  .tabs>*{display:block;margin:6px 0}
  .kpi-grid{grid-template-columns:1fr 1fr}
  .services-grid{grid-template-columns:1fr}
  .fab-home{position:fixed;right:14px;bottom:14px;z-index:9998;width:52px;height:52px;border-radius:999px;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;background:#0ea5e9;color:#fff;font-size:22px;text-decoration:none;box-shadow:0 10px 30px rgba(2,12,27,.18)}
}
/* Login modal */
#loginBackdrop{position:fixed;inset:0;background:rgba(2,12,27,.45);display:none;z-index:10000}
#loginWrap{position:fixed;inset:0;display:none;z-index:10001;place-items:center}
#loginCard{width:min(92vw,560px);background:#fff;border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 20px 60px rgba(2,12,27,.25)}
.login-grid{display:grid;gap:10px}
.login-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.login-input,.login-select{border:1px solid var(--border);border-radius:10px;padding:10px;background:#fff}
.login-actions{display:flex;gap:8px;justify-content:flex-end}
@media (max-width:979px){.login-row{grid-template-columns:1fr}}
a:focus,button:focus,input:focus,select:focus{outline:2px solid #0ea5e9;outline-offset:2px}
</style>
</head>
<body>

<header>
  <div class="topbar">
    <div class="brand" onclick="location.hash='#/overview'" role="link" tabindex="0" aria-label="ุงูุฑุฆูุณูุฉ">
      <img class="logo" src="nomu_logo.png" alt="ุดุนุงุฑ ููู" onerror="this.style.background='#eef2f7'">
      <div><b class="brand-title">ููุตุฉ ููู</b></div>
    </div>
    <a class="home-btn" href="#/overview">ุงูุฑุฆูุณูุฉ</a>
    <button class="mobile-menu-btn" id="mobileMenuBtn">ุงููุงุฆูุฉ โฐ</button>
    <div class="left-logos">
      <img src="vision2030.png" alt="ุดุนุงุฑ ุฑุคูุฉ 2030" onerror="this.style.display='none'">
      <img src="talbiya.png"  alt="ุดุนุงุฑ ุชูุจูุฉ"     onerror="this.style.display='none'">
      <button class="desktop-login-btn" id="desktopLoginBtn">ุชุณุฌูู ุงูุฏุฎูู</button>
      <button id="bell" class="bell" aria-label="ุงูุฅุดุนุงุฑุงุช">๐<span class="badge-dot"></span></button>
    </div>
  </div>
</header>

<div class="layout">
  <aside class="mega-left" aria-label="ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ">
    <details open>
      <summary>ุงูุจุฏุก ุงูุณุฑูุน</summary>
      <div class="group-body">
        <a href="#/overview">ูุธุฑุฉ ุนุงูุฉ</a>
        <a href="#/intro">ูู ูุญู</a>
        <a href="#/services">ุงูุฎุฏูุงุช</a>
      </div>
    </details>
    <details>
      <summary>ุงูุญุณุงุจุงุช</summary>
      <div class="group-body">
        <a href="#/acc/health">ูุฒุงุฑุฉ ุงูุตุญุฉ</a>
        <a href="#/acc/clinic">ุงููุฑุงูุฒ ุงูุตุญูุฉ</a>
        <a href="#/acc/education">ูุฒุงุฑุฉ ุงูุชุนููู</a>
        <a href="#/acc/neighborhood">ูุฑุงูุฒ ุงูุฃุญูุงุก</a>
        <a href="#/acc/nonprofit">ุงูุฌูุนูุงุช</a>
        <a href="#/acc/mhrsd">ูุฒุงุฑุฉ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ ูุงูุชูููุฉ ุงูุงุฌุชูุงุนูุฉ</a>
        <a href="#/acc/csr">ุงููุทุงุน ุงูุฎุงุต</a>
        <a href="#/acc/family">ุงูุฃุณุฑุฉ</a>
        <a href="#/acc/admin">ุงููุฌูุฉ ุงููุทููุฉ</a>
      </div>
    </details>
    <details>
      <summary>ุงูุชุดุบูู ูุงูุชูุงุฑูุฑ</summary>
      <div class="group-body">
        <a href="#/operations">ุงูุชุดุบูู</a>
        <a href="#/reports">ุงูุชูุงุฑูุฑ</a>
        <a href="#/kpi">ูุคุดุฑุงุช KPI</a>
      </div>
    </details>
    <details>
      <summary>ุงูุฏุนู ูุงูุฌูุฏุฉ</summary>
      <div class="group-body">
        <a href="#/support">ุงูุฏุนู ุงูููู</a>
        <a href="#/policies">ุงูุฃุฏูุฉ ูุงูุณูุงุณุงุช</a>
        <a href="#/contact">ุงุชุตู ุจูุง</a>
      </div>
    </details>
  </aside>

  <section id="view" class="content">
    <div class="card">
      <h2 class="section-title">ุฃูููุง ุจู ูู ููุตุฉ ููู</h2>
      <p>ููุตุฉ ูุทููุฉ ุชูุนูู ุจุชูููุฉ ุงูุทูููุฉ ุงููุจูุฑุฉ ุนุจุฑ ุงูุชูุงูู ุจูู ุงููุทุงุนุงุช ูุชูุญูุฏ ุงูุฌููุฏ ูุงูุจูุงูุงุช ูุงููุจุงุฏุฑุงุช.</p>
    </div>
    <div class="kpi-grid" style="margin-top:12px">
      <div class="kpi-card"><div class="kpi-icon">๐</div><div><div class="kpi-title">ูุคุดุฑ ุงูุชุฑุงุถู</div><div class="kpi-meta"><span class="kpi-value">โ</span><span class="badge info">ุนุฑุถ</span></div></div></div>
      <div class="kpi-card"><div class="kpi-icon">๐</div><div><div class="kpi-title">ูุคุดุฑ ุงูุชุฑุงุถู</div><div class="kpi-meta"><span class="kpi-value">โ</span><span class="badge info">ุนุฑุถ</span></div></div></div>
      <div class="kpi-card"><div class="kpi-icon">โญ</div><div><div class="kpi-title">ูุคุดุฑ ุงูุชุฑุงุถู</div><div class="kpi-meta"><span class="kpi-value">โ</span><span class="badge info">ุนุฑุถ</span></div></div></div>
      <div class="kpi-card"><div class="kpi-icon">๐งฉ</div><div><div class="kpi-title">ูุคุดุฑ ุงูุชุฑุงุถู</div><div class="kpi-meta"><span class="kpi-value">โ</span><span class="badge info">ุนุฑุถ</span></div></div></div>
    </div>
  </section>
</div>

<a class="fab-home" href="#/overview" aria-label="ุงูุฑุฆูุณูุฉ" style="display:none">โ</a>

<!-- Login modal -->
<div id="loginBackdrop"></div>
<div id="loginWrap">
  <div id="loginCard" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <h3 id="loginTitle">ุชุณุฌูู ุงูุฏุฎูู</h3>
    <div class="login-grid">
      <div class="login-row">
        <div><label>ุงุณู ุงููุณุชุฎุฏู</label><input id="lg_user" class="login-input" value="NOMU" autocomplete="username"></div>
        <div><label>ูููุฉ ุงููุฑูุฑ</label><input id="lg_pass" class="login-input" type="password" value="1234" autocomplete="current-password"></div>
      </div>
      <div><label>ููุน ุงูุญุณุงุจ</label><select id="lg_acc" class="login-select"></select></div>
      <div class="login-actions"><button id="lg_cancel" class="btn ghost">ุฅูุบุงุก</button><button id="lg_ok" class="btn">ุฏุฎูู</button></div>
      <div id="lg_msg" style="display:none;color:#991b1b">ุงูุฑุฌุงุก ุชุนุจุฆุฉ ุงูุญููู.</div>
    </div>
  </div>
</div>

<script>
/* ===== Utilities ===== */
const $$=(s,root=document)=>Array.from(root.querySelectorAll(s));
const $=(s,root=document)=>root.querySelector(s);
const isMobile = ()=> window.matchMedia && matchMedia("(max-width:979px)").matches;

/* ===== Data ===== */
const ACCOUNTS = {
  "health":    { name:"ูุฒุงุฑุฉ ุงูุตุญุฉ", icon:"๐ฅ" },
  "clinic":    { name:"ุงููุฑุงูุฒ ุงูุตุญูุฉ", icon:"๐ฉบ" },
  "education": { name:"ูุฒุงุฑุฉ ุงูุชุนููู", icon:"๐" },
  "neighborhood": { name:"ูุฑุงูุฒ ุงูุฃุญูุงุก", icon:"๐๏ธ" },
  "nonprofit": { name:"ุงูุฌูุนูุงุช", icon:"๐ค" },
  "mhrsd":     { name:"ูุฒุงุฑุฉ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ ูุงูุชูููุฉ ุงูุงุฌุชูุงุนูุฉ", icon:"๐ฅ" },
  "csr":       { name:"ุงููุทุงุน ุงูุฎุงุต", icon:"๐ข" },
  "family":    { name:"ุงูุฃุณุฑุฉ", icon:"๐จโ๐ฉโ๐ง" },
  "admin":     { name:"ุงููุฌูุฉ ุงููุทููุฉ", icon:"๐ก๏ธ" },
};
const TABS = [
  {key:"summary",   label:"ุงูููุฎุต"},
  {key:"services",  label:"ุงูุฎุฏูุงุช ูุงูุชูููุงุช"},
  {key:"operations",label:"ุงูุนูููุงุช"},
  {key:"indicators",label:"ุงููุคุดุฑุงุช"},
  {key:"reports",   label:"ุงูุชูุงุฑูุฑ"},
  {key:"resources", label:"ุงูููุงุฑุฏ"},
  {key:"governance",label:"ุงูุญูููุฉ"}
];

const ACCOUNT_SERVICES = {
  health:[
    {t:"ููู ุงูุทูู ุงูุตุญู ุงูููุญูุฏ",d:"ุฌูุน ุงูุณุฌู ุงูุตุญู ูุงูุชุทุนููุงุช ูุงููุญูุต ูู ููู ูุงุญุฏ."},
    {t:"ูุธุงู ุชุชุจูุน ุงูุชุทุนููุงุช",d:"ุชูุจููุงุช ููุงุนูุฏ ุงูุชุทุนูู ูุฑุจุท ูุน ุงูุนูุงุฏุงุช."},
    {t:"ููุญุฉ ุงูุฃูุฑุงุถ ุงููุฒููุฉ ููุฃุทูุงู",d:"ูุชุงุจุนุฉ ุงูุญุงูุงุช ุทูููุฉ ุงูุฃูุฏ."},
    {t:"ุชูุงูู ุงูุณุฌู ุงูุฅููุชุฑููู",d:"ุชูุงูู ูุน ุฃูุธูุฉ HIS/EHR."},
    {t:"ุฅุญุงูุฉ ุฐููุฉ",d:"ูุณุงุฑุงุช ุฅุญุงูุฉ ูุนูุงูุฉ."},
  ],
  clinic:[
    {t:"ุญุฌุฒ ุงูููุงุนูุฏ ุงูููุญุฏ",d:"ุฅุฏุงุฑุฉ ุงูุทุงูุฉ ูุฌุฏููุฉ ุงูุฒูุงุฑุงุช."},
    {t:"ุณุฌูุงุช ุงูููู ูุงูุชุบุฐูุฉ",d:"ูุชุงุจุนุฉ ุงููุฒู ูุงูุทูู ูุงูุชุบุฐูุฉ."},
    {t:"ุฅุฏุงุฑุฉ ุงูุฅุญุงูุงุช",d:"ุฅุฑุณุงู/ุงุณุชูุจุงู ูุฅุบูุงู ุงูุฅุญุงูุงุช."},
    {t:"ุฌูุฏุฉ ุงูุฎุฏูุฉ ุงูููููุฉ",d:"ูุชุงุจุนุฉ ุงูุงูุชุฒุงู ูุงููุนุงููุฑ."},
    {t:"ุชูุจููุงุช ุงูุทูุงุฑุฆ",d:"ุชูุจููุงุช ุนุงุฌูุฉ ูููุฑู ุงูุทุจูุฉ."},
  ],
  education:[
    {t:"ุชุญุตูู ูุจูุฑ ูุฑูุงุถ ุงูุฃุทูุงู",d:"ููุงุณ ุงูุชูุฏูู ุงููุบูู ูุงููุนุฑูู."},
    {t:"ุฌุงูุฒูุฉ ูุฏุฑุณูุฉ",d:"ุงุฎุชุจุงุฑุงุช ูุนูุงุฑูุฉ ููุงูุชูุงู."},
    {t:"ุชูุงูู ุตุญู-ุชุนูููู",d:"ุฑุจุท ุงููุคุดุฑุงุช ุงูุตุญูุฉ ุจุงูุฃุฏุงุก."},
    {t:"ูุงุนุฏุฉ ุฐูู ุงูุงุญุชูุงุฌุงุช",d:"ุฎุทุท ุฏุนู ูุฑุฏูุฉ."},
    {t:"ููุงูุฌ ุฑูููุฉ ูุจูุฑุฉ",d:"ูุตุงุฏุฑ ุชูุงุนููุฉ."},
  ],
  neighborhood:[
    {t:"ุงูุชูุนูุฉ ุงูุฃุณุฑูุฉ",d:"ุจุฑุงูุฌ ููุงูุฉ ูุชุฑุจูุฉ ุฅูุฌุงุจูุฉ."},
    {t:"ุฃูุดุทุฉ ูุฌุชูุนูุฉ",d:"ุชุณุฌูู ููุชุงุจุนุฉ ุงููุนุงููุงุช."},
    {t:"ุชูุงูู ูุน ุงูุฌูุนูุงุช",d:"ุฅุณูุงุฏ ุงูุญุงูุงุช ุงุฌุชูุงุนูุงู."},
    {t:"ููุญุฉ ุงููุดุงุฑูุฉ",d:"ูุคุดุฑุงุช ูุดุงุฑูุฉ ุงูุฃุณุฑุฉ ูุงูุทูู."},
  ],
  nonprofit:[
    {t:"ุฅุฏุงุฑุฉ ุงููุดุงุฑูุน ุงูุชููููุฉ",d:"ุงูุชุฎุทูุท ูุงูุชูููุฐ ูุงูุชูููู."},
    {t:"ุชุจุฑุนุงุช ููุฌููุฉ",d:"ุชูุฌูู ุงูุฏุนู ุญุณุจ ุงูุงุญุชูุงุฌ."},
    {t:"ุฅุฏุงุฑุฉ ุงููุชุทูุนูู",d:"ุงุฎุชูุงุฑ ูุชุฏุฑูุจ ูุชุชุจุน ุงูุณุงุนุงุช."},
    {t:"ุชูุงูู ุชูุงุฑูุฑ",d:"ุฑูุน ุชูุงุฑูุฑ ููุญูุฏุฉ."},
    {t:"ููุงุณ ุงูุฃุซุฑ",d:"ูุคุดุฑุงุช ุชุฃุซูุฑ."},
  ],
  mhrsd:[
    {t:"ุจุฑุงูุฌ ุงูุฑุนุงูุฉ ููุฃุณุฑ",d:"ุงุณุชุญูุงูุงุช ูุฏุนู ููุฌูู."},
    {t:"ุชุชุจูุน ุงูุฃุทูุงู ุงููุนุฑุถูู ููุฎุทุฑ",d:"ุงูุชุดุงู ูุจูุฑ ูุชุฏุฎู ูุชุนุฏุฏ."},
    {t:"ุชูุงูู ุงูุญุงูุงุช",d:"ุฑุจุท ุตุญู/ุชุนูููู/ุงุฌุชูุงุนู."},
    {t:"ุฏุนู ุงูุฃุณุฑ ุงูุญุงุถูุฉ",d:"ุฅุณูุงุฏ ูุชูููู ููุชุงุจุนุฉ."},
    {t:"ููุงุณ ุฌูุฏุฉ ุงูุฎุฏูุงุช ุงูุงุฌุชูุงุนูุฉ",d:"ุงูุชุซุงู ูุชุฏููู ุฏูุฑู."},
  ],
  csr:[
    {t:"ุจูุงุจุฉ ุงููุณุคูููุฉ ุงูุงุฌุชูุงุนูุฉ",d:"ุฅุฏุงุฑุฉ ุงููุจุงุฏุฑุงุช ูุงูุชูููู."},
    {t:"ููุญ ููุจุงุฏุฑุงุช",d:"ุชูุฏูู ูุชูููู ูุชุชุจุน."},
    {t:"ููุญุฉ ูุคุดุฑุงุช CSR",d:"ุดูุงููุฉ ุงูุฃุซุฑ ูุงูุฃูุฏุงู."},
    {t:"ุชูุงูู ุนุฑุถ ุงูุจุฑุงูุฌ",d:"ุฅุจุฑุงุฒ ุงูุจุฑุงูุฌ ุงูููููุฉ."},
  ],
  family:[
    {t:"ุชุทุจูู ููู ุทููู",d:"ูุชุงุจุนุฉ ุงูููู ูุงูุชุบุฐูุฉ ูุงูููุงุญุงุช."},
    {t:"ุชูุนูุฉ ุฑูููุฉ ูููุงูุฏูู",d:"ูุญุชูู ููุซูู ูุชูุงุนูู."},
    {t:"ููุงุนูุฏ ูุน ูุฎุชุตูู",d:"ุตุญุฉ/ุชุนููู/ุงุฌุชูุงุนู."},
    {t:"ุงุณุชุดุงุฑุงุช ุชุฑุจููุฉ",d:"ุฃุณุฆูุฉ ูุฅุฌุงุจุงุช ููุซููุฉ."},
    {t:"ุณุฌู ุงูุชุทูุฑ ุงูุณูููู",d:"ุชูุซูู ุงูุชูุฏู."},
  ],
  admin:[
    {t:"ุญูููุฉ ูุทููุฉ",d:"ุณูุงุณุงุช ุชูุงูู."},
    {t:"ูุฑูุฒ ุจูุงูุงุช ูุทูู",d:"ุงุชูุณุงู ููุดุงุฑูุฉ ุขููุฉ."},
    {t:"ูุฑุงูุจุฉ ูุคุดุฑุงุช ุงุณุชุฑุงุชูุฌูุฉ",d:"ููุญุงุช ุขููุฉ."},
    {t:"ุชุญูููุงุช ูุฐูุงุก ุงุตุทูุงุนู",d:"ุชูุจุคุงุช ูุฅูุฐุงุฑุงุช ูุจูุฑุฉ."},
    {t:"ุฅุฏุงุฑุฉ ุงูุดุฑุงูุงุช",d:"ุงุชูุงููุงุช ูุชูุงุฑูุฑ ูุทููุฉ."},
  ],
};

const ACCOUNT_KPIS = {
  health:["ุฅุชูุงู ุงูุชุทุนููุงุช ุงูุฃุณุงุณูุฉ","ุงููุญุต ุงููุจูุฑ ุงูููุชูู","ุฒูู ุงูุชุธุงุฑ ุงูุทูุงุฑุฆ (ุฏ)","ูุชุงุจุนุฉ ุงูุฃูุฑุงุถ ุงููุฒููุฉ","ุฑุถุง ุฃูููุงุก ุงูุฃููุฑ"],
  clinic:["ุงูููุงุนูุฏ ุงููุญุฌูุฒุฉ ุฅููุชุฑูููุงู","ุงูุฅุญุงูุงุช ุงููุบููุฉ < 7 ุฃูุงู","ุฑุถุง ุงููุณุชููุฏูู ุงููููู","ุฒูู ุชูุฏูู ุฃูู ุฎุฏูุฉ (ุฏ)","ุงูุชุฒุงู ุงูุฒูุงุฑุงุช ุงูููุงุฆูุฉ"],
  education:["ุงูุงูุชุญุงู ุจุฑูุงุถ ุงูุฃุทูุงู","ุฌุงูุฒูุฉ ูุฏุฑุณูุฉ (ูุคุดุฑ)","ุชุฏุฑูุจ ูุนููู ุงูุทูููุฉ","ุงูุชูุงู ูุงุฌุญ ููุตู ุงูุฃูู","ูุจุงุฏุฑุงุช ุชูุงูููุฉ"],
  neighborhood:["ูุนุงููุงุช ููููุฐุฉ/ุดูุฑ","ูุดุงุฑูุฉ ุฃุณุฑูุฉ ูู ุงูุชูุนูุฉ","ูุดุงุฑูุฉ ุฃุทูุงู ุจุงูุฃูุดุทุฉ","ุฑุถุง ุงููุฌุชูุน","ุชูุณูู ูุน ุงูุฌูุงุช"],
  nonprofit:["ุนุฏุฏ ุงูุจุฑุงูุฌ ููุฃุทูุงู","ุงูุฏุนู ุงููุงูู/ุงูุนููู","ุชุญูู ุฃุซุฑ ูุฌุชูุนู","ูุชุทูุนูู ูุดุทูู","ุดูุงููุฉ ุงูุชูุงุฑูุฑ"],
  mhrsd:["ุฃุณุฑ ูุณุชููุฏุฉ","ูุนุงูุฌุฉ ุงูุจูุงุบุงุช ุจุงููุฏุฉ","ุฑุถุง ุงููุณุชููุฏูู ุงูุงุฌุชูุงุนู","ุชูุณูู ุจูู ุงูุฌูุงุช","ุงูููุงูุฉ ูู ุงูุนูู ุงูุฃุณุฑู"],
  csr:["ุจุฑุงูุฌ ููููุฉ","ุฅุฌูุงูู ุงููุณุงููุงุช","ุดูุงููุฉ ุงูุชูุงุฑูุฑ","ูุดุงุฑูุฉ ุจุงููุจุงุฏุฑุงุช ุงูุญููููุฉ","ุงูุฃุซุฑ ุงูุงุฌุชูุงุนู"],
  family:["ุชูุงุนู ุงูุฃุณุฑ","ุฒูุงุฑุงุช/ุฃุณุฑุฉ/ุดูุฑ","ูููุงุช ููู ููุชููุฉ","ุฑุถุง ุงููุณุชุฎุฏููู","ุชุญุณู ูุคุดุฑุงุช ููู ุงูุฃุทูุงู"],
  admin:["ุฌูุงุช ูุชูุงููุฉ ูุทููุงู","ูุคุดุฑุงุช ูุญุฏูุซุฉ ุขููุงู","ุงูุงูุชุฒุงู ุจุณูุงุณุงุช ุงูุจูุงูุงุช","ุณุฑุนุฉ ุชูุงุฑูุฑ ูุทููุฉ","ุงูุฃุซุฑ ุนูู ุฃูุฏุงู 2030"],
};

const GLOBAL_SERVICES = [
  {t:"ููุญุฉ ูุชุงุจุนุฉ ุงูุทูููุฉ ุงููุจูุฑุฉ", d:"ูุธุฑุฉ ุดุงููุฉ ููุจูุงูุงุช ูุงููุคุดุฑุงุช ุนุจุฑ ุงูุฌูุงุช."},
  {t:"ุฅุฏุงุฑุฉ ุงูุฅุญุงูุงุช", d:"ูุณุงุฑ ููุญุฏ ููุฅุญุงูุฉ ูุงููุชุงุจุนุฉ ูุงูุฅุบูุงู."},
  {t:"ุณุฌู ุงูุทูู ุงูููุญูุฏ", d:"ููู ููุญุฏ ูุฑุจุท ุงูุตุญุฉ ูุงูุชุนููู ูุงูุงุฌุชูุงุนู."},
  {t:"ุชูุงุฑูุฑ ููุงุณ ุงูุฃุซุฑ", d:"ุชุญููู ุฃุซุฑ ุงูุจุฑุงูุฌ ูุงูุชุฏุฎูุงุช."},
  {t:"ุฃุชูุชุฉ ุงูุชูุจููุงุช", d:"ุฅุดุนุงุฑุงุช ุฐููุฉ ููุญุงูุงุช ุงูุญุฑุฌุฉ ูุงูุงูุญุฑุงูุงุช."},
  {t:"ูุฎุฒูู ุงูุฎุฏูุงุช ูุงูุทุงูุงุช", d:"ุฑุตุฏ ุงูุทุงูุฉ ุงูุงุณุชูุนุงุจูุฉ ูุงูุชุบุทูุฉ."},
  {t:"ุชูุงูู ุงูุจูุงูุงุช", d:"ูุงุฌูุงุช API ููุดุงุฑูุฉ ุขููุฉ ููุจูุงูุงุช."},
  {t:"ุญูููุฉ ุงูุจูุงูุงุช ูุงูุงูุชุซุงู", d:"ุณูุงุณุงุช ูุตูุงุญูุงุช ูุชุชุจุน ูุชุฏููู."},
  {t:"ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงููุชูุฏูุฉ", d:"ุญูุฒู ูุคุดุฑุงุช ูุฑุชุจุทุฉ ุจุงูุฃูุฏุงู."},
];

/* ===== Helpers ===== */
function grade(num, kind){ if(kind==="wait"){ if(num<=10)return"ok"; if(num<=20)return"warn"; return"bad"; } return num>=85?"ok": num>=70?"warn":"bad"; }
function gradeLabel(g){ return g==="ok"?"ุฌูุฏ":g==="warn"?"ุชุญุฐูุฑ":"ุญุฑูุฌ"; }
function makeDemoKPIsFromList(list){
  return list.map(t=>{
    let v=0, unit="%", g="info";
    if (/ุงูุชุธุงุฑ|ุฏ\)/.test(t)) { v = 5 + Math.floor(Math.random()*20); unit="ุฏ"; g = grade(v,"wait"); }
    else { v = +(70 + Math.random()*25).toFixed(0); g = grade(v); }
    const trend = (Math.random()>.5?"+":"-") + (Math.random()*5|0) + "%";
    return {title:t, icon:"๐", value: v + unit, grade:g, trend};
  });
}
function servicesGrid(items){ return '<div class="services-grid">'+ items.map(s=>`
  <div class="service"><h4>${s.t}</h4><p>${s.d}</p></div>`).join('') + '</div>'; }

/* ===== Desktop accordion: keep one open ===== */
function accordionOneOpen(scope){
  const groups = $$('details', scope || $('.mega-left'));
  groups.forEach(d => d.addEventListener('toggle', () => {
    if (d.open) groups.forEach(x => { if (x!==d) x.open=false; });
  }));
}

/* ===== Mobile sheet menu ===== */
function openMobileMenu(){
  if (!isMobile()) return;
  if ($('#mobileMenuSheet')) return;
  const sheet = document.createElement('div');
  sheet.id='mobileMenuSheet';
  sheet.style.cssText='position:fixed;inset:auto 0 0 0;background:#fff;border-top:1px solid var(--border);border-radius:16px 16px 0 0;box-shadow:0 -12px 30px rgba(2,12,27,.15);z-index:9999;max-height:65vh;overflow:auto;padding:12px;transform:translateY(16px);opacity:0;transition:.2s';
  sheet.innerHTML = $('.mega-left').innerHTML;
  $$('a', sheet).forEach(a=> a.addEventListener('click', e=>{ e.preventDefault(); location.hash = a.getAttribute('href'); close(); }));
  document.body.appendChild(sheet);
  requestAnimationFrame(()=>{ sheet.style.transform='translateY(0)'; sheet.style.opacity='1'; });
  function close(){ sheet.style.transform='translateY(16px)'; sheet.style.opacity='0'; setTimeout(()=> sheet.remove(), 180); }
  accordionOneOpen(sheet);
  setTimeout(()=> document.addEventListener('click', (ev)=>{ if(!sheet.contains(ev.target)) close(); }, {once:true}), 0);
}

/* ===== Login modal and guard ===== */
const loginBackdrop = $('#loginBackdrop');
const loginWrap = $('#loginWrap');
function showLogin(pref){
  const sel = $('#lg_acc');
  if (!sel.options.length){ Object.entries(ACCOUNTS).forEach(([k,v])=>{ const o=document.createElement('option'); o.value=k; o.textContent=v.name; sel.appendChild(o); }); }
  if (pref && ACCOUNTS[pref]) sel.value=pref;
  loginBackdrop.style.display='block'; loginWrap.style.display='grid';
  setTimeout(()=> $('#lg_user').focus(), 0);
}
function hideLogin(){ loginBackdrop.style.display='none'; loginWrap.style.display='none'; }
$('#lg_cancel').onclick = hideLogin;
$('#lg_ok').onclick = ()=>{
  const u = $('#lg_user').value.trim();
  const p = $('#lg_pass').value.trim();
  const a = $('#lg_acc').value;
  if (!u || !p || !a){ $('#lg_msg').style.display='block'; return; }
  localStorage.setItem('nomu_auth', JSON.stringify({user:u, acc:a}));
  hideLogin();
  location.hash = `#/acc/${a}?tab=summary`;
};
$('#desktopLoginBtn').onclick = (e)=>{ e.preventDefault(); showLogin(); };

/* ===== View renderers ===== */
const view = $('#view');

function renderOverview(){
  const kpis = makeDemoKPIsFromList(["ุชุบุทูุฉ ุงูุฎุฏูุงุช","ุงูุชูุงูู ุจูู ุงูุฌูุงุช","ุฑุถุง ุงููุณุชููุฏูู","ุณุฑุนุฉ ุงููุนุงูุฌุฉ","ุฌูุฏุฉ ุงูุจูุงูุงุช","ุงูุฃุซุฑ ุงููุฌุชูุนู","ููุงุกุฉ ุงูุฅููุงู","ุงูุชุญุณูู ุงููุณุชูุฑ"]).slice(0,8);
  view.innerHTML = `
    <div class="card"><h2 class="section-title">ูุธุฑุฉ ุนุงูุฉ</h2>
      <p style="color:#64748b">ููุฎุต ุณุฑูุน ูุฃุจุฑุฒ ุงููุคุดุฑุงุช ุนุจุฑ ุงูููุธููุฉ.</p>
    </div>
    <div class="kpi-grid" style="margin-top:12px">
      ${kpis.map(k=>`
        <div class="kpi-card" data-kpi="${k.title}">
          <div class="kpi-icon">๐</div>
          <div><div class="kpi-title">${k.title}</div>
            <div class="kpi-meta"><span class="kpi-value">${k.value}</span>
              <span class="badge ${k.grade}">${gradeLabel(k.grade)}</span>
              <span class="badge info">${k.trend}</span>
            </div></div>
        </div>`).join('')}
    </div>`;
  $$('.kpi-card', view).forEach(card=> card.addEventListener('click', ()=> openKPIDetail(card.dataset.kpi)));
}

function renderIntro(){
  view.innerHTML = `
    <div class="card">
      <h2 class="section-title">ูู ูุญู</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="card" style="border-style:dashed"><b>ุงูุฑุคูุฉ</b><br>ุฃู ุชููู ุงููุฑุฌุน ุงููุทูู ุงูุดุงูู ูุชุทููุฑ ููุธููุฉ ุงูุทูููุฉ ุงููุจูุฑุฉ.</div>
        <div class="card" style="border-style:dashed"><b>ุงูุฑุณุงูุฉ</b><br>ุชูููู ุงูุฌูุงุช ุนุจุฑ ุฃุฏูุงุช ุชุญููููุฉ ูุชุดุบูููุฉ ููุคุดุฑุงุช ุฃุฏุงุก ุฏุงุนูุฉ ูุตูุน ุงููุฑุงุฑ.</div>
      </div>
      <div class="card" style="margin-top:12px"><b>ุงูุฃูุฏุงู ุงูุฅุณุชุฑุงุชูุฌูุฉ</b>
        <ul style="margin:8px 0 0 0;padding-inline-start:18px">
          <li>ุฑูุน ุฌูุฏุฉ ูููุงุกุฉ ุงูุฎุฏูุงุช ุงูููุฏูุฉ ููุทูู ูุงูุฃุณุฑุฉ.</li>
          <li>ุชุนุฒูุฒ ุงูุชูุงูู ูุงูููุงุกูุฉ ุจูู ุงูุฌูุงุช ูุงูุจุฑุงูุฌ.</li>
          <li>ุชุญุณูู ุฅุชุงุญุฉ ุงูุจูุงูุงุช ูุฏุนู ุงุชุฎุงุฐ ุงููุฑุงุฑ.</li>
          <li>ููุงุณ ุงูุฃุซุฑ ูุชุญุณูู ุงูุงุณุชุซูุงุฑ ุงูุงุฌุชูุงุนู.</li>
        </ul>
      </div>
    </div>`;
}

function renderServices(){
  view.innerHTML = `
    <div class="card"><h2 class="section-title">ูุชุงููุฌ ุงูุฎุฏูุงุช</h2>
      <div class="toolbar">
        <input id="svcSearch" class="input" placeholder="ุงุจุญุซ ุนู ุฎุฏูุฉ...">
        <button class="btn ghost" id="svcReset">ูุณุญ</button>
      </div>
      <div id="svcGrid" class="services-grid">${GLOBAL_SERVICES.map(s=>`
        <div class="service"><h4>${s.t}</h4><p>${s.d}</p></div>`).join('')}</div>
    </div>`;
  $('#svcSearch').oninput = ()=> filterServices($('#svcSearch').value, '#svcGrid');
  $('#svcReset').onclick = ()=>{ $('#svcSearch').value=''; filterServices('', '#svcGrid'); };
}

function filterServices(q, rootSel){
  $$('.service', $(rootSel)).forEach(it=>{
    const hit = it.textContent.toLowerCase().includes((q||'').toLowerCase());
    it.style.display = hit ? 'block' : 'none';
  });
}

function renderAccount(accKey, tabKey){
  const acc = ACCOUNTS[accKey];
  if (!acc){ render404(); return; }
  const current = (TABS.find(t=>t.key===tabKey)||TABS[0]).key;
  view.innerHTML = `
    <div class="card" style="display:flex;justify-content:space-between;align-items:center;gap:10px">
      <div style="display:flex;align-items:center;gap:10px">
        <div class="kpi-icon" style="font-size:24px">${acc.icon}</div>
        <div><div style="font-weight:800">${acc.name}</div>
          <div style="color:#64748b;font-size:13px">ููุญุฉ ุชุญูู ุงูุญุณุงุจ ยท ุชุจููุจ: <b>${(TABS.find(t=>t.key===current)||{}).label||""}</b></div>
        </div>
      </div>
      <a class="btn ghost" href="#/services">ูุชุงููุฌ ุงูุฎุฏูุงุช</a>
    </div>
    <nav class="tabs" role="tablist" aria-label="ุชุจููุจุงุช ุงูุญุณุงุจ">
      ${TABS.map(t=>`<a class="tab" role="tab" aria-selected="${t.key===current}" href="#/acc/${accKey}?tab=${t.key}">${t.label}</a>`).join('')}
    </nav>
    <div id="accContent"></div>`;

  const mount = $('#accContent');

  if (current==="summary"){
    const data = makeDemoKPIsFromList(ACCOUNT_KPIS[accKey] || []);
    mount.innerHTML = `<div class="kpi-grid">${data.map(k=>`
      <div class="kpi-card" data-kpi="${k.title}">
        <div class="kpi-icon">๐</div>
        <div><div class="kpi-title">${k.title}</div>
          <div class="kpi-meta"><span class="kpi-value">${k.value}</span>
            <span class="badge ${k.grade}">${gradeLabel(k.grade)}</span>
            <span class="badge info">${k.trend}</span>
          </div></div>
      </div>`).join('')}</div>`;
    $$('.kpi-card', mount).forEach(card=> card.addEventListener('click', ()=> openKPIDetail(card.dataset.kpi)));
  }

  if (current==="services"){
    const scoped = (ACCOUNT_SERVICES[accKey]||[]).concat(GLOBAL_SERVICES);
    mount.innerHTML = `<div class="toolbar">
        <input id="svcSearch2" class="input" placeholder="ุงุจุญุซ ูู ุฎุฏูุงุช ${acc.name}...">
        <button class="btn ghost" id="svcReset2">ูุณุญ</button>
      </div>
      <div id="svcGrid2" class="services-grid">${scoped.map(s=>`
        <div class="service"><h4>${s.t}</h4><p>${s.d}</p></div>`).join('')}</div>`;
    $('#svcSearch2').oninput = ()=> filterServices($('#svcSearch2').value, '#svcGrid2');
    $('#svcReset2').onclick = ()=>{ $('#svcSearch2').value=''; filterServices('', '#svcGrid2'); };
  }

  if (current==="operations"){
    mount.innerHTML = `<div class="card"><b>ุงูุนูููุงุช ุงูุฌุงุฑูุฉ</b>
      <ul style="margin:8px 0 0 0;padding-inline-start:18px">
        <li>ุญููุฉ ุงููุญุต ุงููุจูุฑ</li><li>ุชุญุณูู ูุณุงุฑ ุงูุฅุญุงูุงุช</li><li>ูุชุงุจุนุฉ ุฒูู ุงูุงูุชุธุงุฑ</li>
      </ul>
      <div class="toolbar" style="margin-top:10px">
        <input id="newOp_${accKey}" class="input" placeholder="ุฃุถู ูููุฉ ุชุดุบูููุฉ...">
        <button class="btn" id="addOp_${accKey}">ุฅุถุงูุฉ</button>
      </div>
      <div id="opList_${accKey}"></div>
    </div>`;
    const list = $('#opList_'+accKey);
    $('#addOp_'+accKey).onclick = ()=>{
      const inp = $('#newOp_'+accKey); const v = inp.value.trim(); if(!v) return;
      const row = document.createElement('div'); row.className='card'; row.style.marginTop='8px';
      row.innerHTML = `<div style="display:flex;justify-content:space-between;gap:8px"><span>${v}</span><button class="btn ghost">ุชู</button></div>`;
      row.querySelector('button').onclick = ()=> row.remove();
      list.appendChild(row); inp.value='';
    };
  }

  if (current==="indicators"){
    const data = makeDemoKPIsFromList(ACCOUNT_KPIS[accKey] || []);
    mount.innerHTML = `<table class="table">
      <thead><tr>
        <th data-k="title">ุงููุคุดุฑ</th><th data-k="value">ุงููููุฉ</th>
        <th data-k="grade">ุงูุชูููู</th><th data-k="trend">ุงูุงุชุฌุงู</th><th>ุขุฎุฑ ุชุญุฏูุซ</th>
      </tr></thead>
      <tbody>${data.map(k=>`
        <tr>
          <td>${k.title}</td>
          <td><b>${k.value}</b></td>
          <td><span class="badge ${k.grade}">${gradeLabel(k.grade)}</span></td>
          <td><span class="badge info">${k.trend}</span></td>
          <td><span class="badge">ุงูููู</span></td>
        </tr>`).join('')}</tbody>
    </table>`;
    // ูุฑุฒ ุจุงูููุฑ
    $$('th[data-k]', mount).forEach(th=>{
      let asc=true; th.addEventListener('click', ()=>{
        const idx = {title:0,value:1,grade:2,trend:3}[th.dataset.k];
        const rows = $$('tbody tr', mount);
        rows.sort((a,b)=>{
          const A=a.children[idx].textContent.trim(), B=b.children[idx].textContent.trim();
          return asc ? A.localeCompare(B,'ar') : B.localeCompare(A,'ar');
        }).forEach(r=> r.parentNode.appendChild(r)); asc=!asc;
      });
    });
  }

  if (current==="reports"){
    mount.innerHTML = `<div class="services-grid" style="grid-template-columns:repeat(3,minmax(0,1fr))">
      ${["ุงูุฃุฏุงุก ุงูุดูุฑู","ุงูุฌูุฏุฉ ูุงูุงูุชุซุงู","ุงูุฅุญุงูุงุช ูุงูุงูุชุธุงุฑ","ุงูุชุบุทูุฉ ุงูุฌุบุฑุงููุฉ","ุงูุฃุซุฑ ุงููุฌุชูุนู","ููุงุกุฉ ุงูุฅููุงู"].map(t=>`
        <a class="service" href="#" onclick="return false" style="text-decoration:none">
          <h4>ุชูุฑูุฑ ${t}</h4><p>PDF ยท ุขุฎุฑ ุฅุตุฏุงุฑ</p>
        </a>`).join('')}
    </div>`;
  }

  if (current==="resources"){
    mount.innerHTML = `<div class="card"><b>ุงูููุงุฑุฏ</b>
      <ul style="margin:8px 0 0 0;padding-inline-start:18px">
        <li><a href="#/policies">ุงูุฃุฏูุฉ ูุงูุณูุงุณุงุช</a></li>
        <li><a href="#/support">ุงูุฏุนู ุงูููู</a></li>
        <li><a href="#/contact">ุงุชุตู ุจูุง</a></li>
      </ul></div>`;
  }

  if (current==="governance"){
    mount.innerHTML = `<div class="card"><b>ุงูุญูููุฉ ูุงูุฃุฏูุงุฑ</b>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="card" style="border-style:dashed"><b>ุงูุฃุฏูุงุฑ</b>
          <ul style="margin:6px 0 0 0;padding-inline-start:18px">
            <li>ูุงูู ุงูุญุณุงุจ</li><li>ูุดุฑู ุงููุคุดุฑุงุช</li><li>ููุณู ุงูุชูุงุฑูุฑ</li><li>ุฏุนู ููู</li>
          </ul>
        </div>
        <div class="card" style="border-style:dashed"><b>ุณูุงุณุงุช ุงูุจูุงูุงุช</b>
          <ul style="margin:6px 0 0 0;padding-inline-start:18px">
            <li>ุฃูู ุตูุงุญูุฉ</li><li>ุฅุฎูุงุก ุงููููุฉ</li><li>ุชุฏููู ุงูุฏุฎูู ูุงูุชุบููุฑุงุช</li>
          </ul>
        </div>
      </div></div>`;
  }
}

function renderSupport(){
  view.innerHTML = `<div class="card"><h2>ุงูุฏุนู ุงูููู</h2>
    <p style="color:#64748b">ููุทูุงุฑุฆ ุงูุชุดุบูููุฉ ุฃู ุงููุดุงูู ุงูุชูููุฉ.</p>
    <div class="toolbar">
      <input id="ticketTitle" class="input" placeholder="ุนููุงู ุงูุทูุจ">
      <button class="btn" id="openTicket">ุฅุฑุณุงู</button>
    </div>
    <div id="tickets" class="card" style="margin-top:10px;border-style:dashed">ูุง ุชูุฌุฏ ุชุฐุงูุฑ ุจุนุฏ.</div>
  </div>`;
  const box = $('#tickets');
  $('#openTicket').onclick = ()=>{
    const t = $('#ticketTitle').value.trim(); if(!t) return;
    if (box.textContent.includes('ูุง ุชูุฌุฏ')) box.textContent = '';
    const row = document.createElement('div'); row.className='card'; row.style.marginTop='8px';
    row.innerHTML = `<div style="display:flex;justify-content:space-between;gap:8px"><span>${t}</span><span class="badge info">ุฌุฏูุฏ</span></div>`;
    box.appendChild(row); $('#ticketTitle').value='';
  };
}
function renderPolicies(){
  view.innerHTML = `<div class="card"><h2>ุงูุฃุฏูุฉ ูุงูุณูุงุณุงุช</h2>
    <ul style="margin:8px 0 0 0;padding-inline-start:18px">
      <li>ุณูุงุณุฉ ุงูุฎุตูุตูุฉ ูุญูุงูุฉ ุงูุจูุงูุงุช</li>
      <li>ุณูุงุณุฉ ูุดุงุฑูุฉ ุงูุจูุงูุงุช ุจูู ุงูุฌูุงุช</li>
      <li>ุฅุฏุงุฑุฉ ุงููููุฉ ูุงูุตูุงุญูุงุช</li>
      <li>ุฅุฌุฑุงุกุงุช ุงูุงุณุชุฌุงุจุฉ ููุญูุงุฏุซ</li>
    </ul></div>`;
}
function renderContact(){
  view.innerHTML = `<div class="card"><h2>ุงุชุตู ุจูุง</h2>
    <div class="toolbar">
      <input class="input" id="ct_name" placeholder="ุงูุงุณู">
      <input class="input" id="ct_mail" placeholder="ุงูุจุฑูุฏ">
      <input class="input" id="ct_msg" placeholder="ุฑุณุงูุชู">
      <button class="btn" id="ct_send">ุฅุฑุณุงู</button>
    </div>
    <div id="ct_status" style="color:#065f46;display:none">โ ุชู ุงูุงุณุชูุงู.</div>
  </div>`;
  $('#ct_send').onclick = ()=>{ $('#ct_status').style.display='block'; setTimeout(()=> $('#ct_status').style.display='none', 1600); };
}

/* ===== KPI detail sheet ===== */
function openKPIDetail(name){
  const sheet=document.createElement('div');
  sheet.style.cssText='position:fixed;inset:auto 0 0 0;background:#fff;border-top:1px solid var(--border);border-radius:16px 16px 0 0;box-shadow:0 -12px 30px rgba(2,12,27,.15);z-index:9999;max-height:65vh;overflow:auto;padding:16px;transform:translateY(16px);opacity:0;transition:.2s';
  sheet.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
    <h3 style="margin:0">${name}</h3>
    <button class="btn ghost" id="closeKPI">ุฅุบูุงู</button>
  </div>
  <div class="card" style="margin-top:10px">
    <b>ููุงุญุธุฉ:</b> ูุฐู ุจูุงูุงุช ุชุฌุฑูุจูุฉ ููุนุฑุถ. ุงุฑุจุท ุงููุคุดุฑ ุจูุตุฏุฑ ุจูุงูุงุชู ูุฅุธูุงุฑ ุงูููู ุงูุญููููุฉ.
  </div>`;
  document.body.appendChild(sheet);
  requestAnimationFrame(()=>{ sheet.style.transform='translateY(0)'; sheet.style.opacity='1'; });
  sheet.querySelector('#closeKPI').onclick = ()=>{ sheet.style.transform='translateY(16px)'; sheet.style.opacity='0'; setTimeout(()=> sheet.remove(), 180); };
}

/* ===== Router ===== */
function parseRoute(){
  const h = location.hash || "";
  if (!h || h==="#" || h==="#/") return {type:"overview"};
  if (h==="#/overview") return {type:"overview"};
  if (h==="#/intro") return {type:"intro"};
  if (h==="#/services") return {type:"services"};
  if (h==="#/support") return {type:"support"};
  if (h==="#/policies") return {type:"policies"};
  if (h==="#/contact") return {type:"contact"};
  const m = h.match(/^#\/acc\/([^?]+)(?:\?tab=([a-z]+))?/);
  if (m) return {type:"acc", key:m[1], tab:m[2]||"summary"};
  return {type:"unknown"};
}
function applyTitle(){
  const h = location.hash;
  const MAP={"#/overview":"ูุธุฑุฉ ุนุงูุฉ โ ููุตุฉ ููู","#/intro":"ูู ูุญู โ ููุตุฉ ููู","#/services":"ุงูุฎุฏูุงุช โ ููุตุฉ ููู","#/support":"ุงูุฏุนู ุงูููู โ ููุตุฉ ููู","#/policies":"ุงูุฃุฏูุฉ ูุงูุณูุงุณุงุช โ ููุตุฉ ููู","#/contact":"ุงุชุตู ุจูุง โ ููุตุฉ ููู"};
  if (MAP[h]) document.title = MAP[h];
  if (/^#\/acc\//.test(h)) document.title = "ุงูุญุณุงุจ โ ููุตุฉ ููู";
}
function route(){
  applyTitle();
  const sess = localStorage.getItem('nomu_auth');
  const r = parseRoute();
  if (r.type==="acc" && !sess){ showLogin(r.key); location.hash = '#/overview'; return; }
  if (r.type==="overview") return renderOverview();
  if (r.type==="intro") return renderIntro();
  if (r.type==="services") return renderServices();
  if (r.type==="support") return renderSupport();
  if (r.type==="policies") return renderPolicies();
  if (r.type==="contact") return renderContact();
  if (r.type==="acc") return renderAccount(r.key, r.tab);
  return render404();
}
function render404(){ view.innerHTML = `<div class="card"><h2>ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุตูุญุฉ</h2><p>ุชุญูู ูู ุงูุฑุงุจุท ุฃู ุงุฎุชุฑ ุตูุญุฉ ูู ุงููุงุฆูุฉ.</p></div>`; }

/* ===== Startup ===== */
window.addEventListener('hashchange', route);
window.addEventListener('load', ()=>{
  accordionOneOpen();
  if (!location.hash || location.hash==="#" || location.hash==="#/") location.hash = '#/overview';
  route();
  const fab=$('.fab-home'); function ensureFab(){ if (isMobile()) fab.style.display='flex'; else fab.style.display='none'; } ensureFab(); addEventListener('resize', ensureFab);
});
/* Topbar actions */
$('#mobileMenuBtn').onclick = (e)=>{ e.preventDefault(); openMobileMenu(); };
$('#bell').onclick = (e)=>{ e.preventDefault(); const t=document.createElement('div'); t.textContent='ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช ุฌุฏูุฏุฉ.'; t.style.cssText='position:fixed;left:50%;transform:translateX(-50%);top:16px;background:#0ea5e9;color:#fff;padding:8px 12px;border-radius:10px;z-index:9999'; document.body.appendChild(t); setTimeout(()=>{ t.style.opacity='0'; t.style.transition='.2s'; setTimeout(()=> t.remove(), 180); }, 1200); };
/* Keyboard shortcut */
document.addEventListener('keydown', (e)=>{ const inInput=/^(INPUT|TEXTAREA|SELECT)$/.test(document.activeElement?.tagName||''); if(inInput) return; if((e.altKey&&(e.key==='h'||e.key==='H'))||(e.key==='h'||e.key==='H')){ e.preventDefault(); location.hash='#/overview'; } });
</script>

<!-- ===== ุฑุจุท ุจูุงูุงุช ุญููููุฉ (ุงุฎุชูุงุฑู) โ ูููู ุชุฑูู ููุง ูู ูุณูุนูู ุจุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ===== -->
<script>
const USE_DEMO_DATA = true;
const DATA_SOURCES = {
  health:{json:'data/health.json'}, clinic:{json:'data/clinic.json'}, education:{json:'data/education.json'},
  neighborhood:{json:'data/neighborhood.json'}, nonprofit:{json:'data/nonprofit.json'}, mhrsd:{json:'data/mhrsd.json'},
  csr:{json:'data/csr.json'}, family:{json:'data/family.json'}, admin:{json:'data/admin.json'}
};
async function loadKPIsReal(accountKey){
  const src = DATA_SOURCES[accountKey] || {}; if (!src.json) return [];
  try{ const d = await (await fetch(src.json, {cache:'no-store'})).json(); return normalizeKPIs(d); }catch(e){ return []; }
}
function normalizeKPIs(payload){
  const out=[]; if(Array.isArray(payload)){ payload.forEach(x=>out.push({title:x.title||x.name||'ูุคุดุฑ',value:String(x.value??'โ'),grade:x.grade||x.status||'info',trend:x.trend||x.delta||'',icon:x.icon||'๐'})); }
  else if(payload&&Array.isArray(payload.kpis)){ payload.kpis.forEach(x=>out.push({title:x.title,value:String(x.value??'โ'),grade:x.grade||'info',trend:x.trend||'',icon:x.icon||'๐'})); }
  else if(payload&&typeof payload==='object'){ Object.entries(payload).forEach(([k,v])=>out.push({title:k,value:String(v.value??'โ'),grade:v.grade||'info',trend:v.trend||'',icon:v.icon||'๐'})); }
  return out;
}
const __origRenderAccount = window.renderAccount;
window.renderAccount = async function(accKey, tabKey){
  __origRenderAccount(accKey, tabKey);
  const mount = document.getElementById('accContent'); if(!mount) return;
  const current = (window.TABS||[]).find(t=>t.key===tabKey)?.key || 'summary';
  const list = (window.ACCOUNT_KPIS && window.ACCOUNT_KPIS[accKey]) ? window.ACCOUNT_KPIS[accKey] : [];
  if (current!=='summary' && current!=='indicators') return;
  const data = USE_DEMO_DATA ? makeDemoKPIsFromList(list) : (await loadKPIsReal(accKey)).length ? await loadKPIsReal(accKey) : makeDemoKPIsFromList(list);
  if (current==='summary'){
    mount.innerHTML = `<div class="kpi-grid">${
      data.slice(0,8).map(k=>`
        <div class="kpi-card">
          <div class="kpi-icon">${k.icon||'๐'}</div>
          <div><div class="kpi-title">${k.title}</div>
            <div class="kpi-meta"><span class="kpi-value">${k.value}</span>
              <span class="badge ${k.grade||'info'}">${(window.gradeLabel?window.gradeLabel(k.grade):k.grade)||''}</span>
              ${k.trend?`<span class="badge info">${k.trend}</span>`:''}
            </div></div>
        </div>`).join('')
    }</div>`;
  } else {
    mount.innerHTML = `<table class="table">
      <thead><tr><th>ุงููุคุดุฑ</th><th>ุงููููุฉ</th><th>ุงูุชูููู</th><th>ุงูุงุชุฌุงู</th><th>ุขุฎุฑ ุชุญุฏูุซ</th></tr></thead>
      <tbody>${
        data.map(k=>`
          <tr><td>${k.title}</td><td><b>${k.value}</b></td>
          <td><span class="badge ${k.grade||'info'}">${(window.gradeLabel?window.gradeLabel(k.grade):k.grade)||''}</span></td>
          <td>${k.trend?`<span class="badge info">${k.trend}</span>`:''}</td>
          <td><span class="badge">ุงูููู</span></td></tr>`).join('')
      }</tbody></table>`;
  }
};
</script>
</body>
</html>
